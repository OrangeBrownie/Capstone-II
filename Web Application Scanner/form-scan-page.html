<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>
		Web Application Scanner
	</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
	<meta name="viewport" content="width=device-width" />

	<link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png" />
	<link rel="icon" type="image/png" href="assets/img/msu_gensan_logo.png" />

	<!--     Fonts and icons     -->
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />

	<!-- CSS Files -->
	<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
	<link href="assets/css/material-bootstrap-wizard.css" rel="stylesheet" />

	<!-- CSS Just for demo purpose, don't include it in your project -->
	<link href="assets/css/demo.css" rel="stylesheet" />
	<!-- Datatables -->
	<link href="assets/vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
	<link href="assets/vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
	<link href="assets/vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
	<link href="assets/vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
	<link href="assets/vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">

	<script src="/dist/tesseract.dev.js"></script>
	<script src="assets/vendors/custom.min.js"></script>

</head>

<body>
	<div class="image-container set-full-height header-filter" style="background-image: url('assets/img/website-backdrop.jpg'); background-size: cover; background-position: top center;">
		<!--   Creative Tim Branding   -->
		<a href="http://www.msugensan.edu.ph/msugensantos/">
			<div class="logo-container">
				<div class="logo">
					<img src="assets/img/msu_gensan_logo.png">
				</div>
				<div class="navbar-brand">
					Team P.G.T.
				</div>
			</div>
		</a>
		<div class="container">
			<nav class="float-right">
				<div class="card-footer justify-content-center">
					<li class="button-container nav-item iframe-extern">
						<a href="login-page.html" class="btn btn-rose btn-round btn-block">Logout</a>
					</li>
				</div>
			</nav>
		</div>
		<!--   Big container   -->
		<div class="container">
			<div class="row">
				<div class="col-sm-10 col-sm-offset-1">
					<!--      Wizard container        -->
					<div class="right_col" role="main">
						<div class="">
							<div id="results" hidden>
								<button type="button" id="settable">Set Tables</button>
								<button type="button" id="gradeImg" class="cutting" hidden="">Grade Image</button>
								<div class="x_panel">
									<div class="x_title">
										<h2>OMR <small>Results</small></h2>
										<div class="clearfix"></div>
									</div>
									<div class="x_content">
										<table id="datatable-buttons2" class="table table-striped table-bordered dataTable datatable-buttons">
											<thead>
												<tr id="resultsFormOmrHead">
													<th>ID</th>
												</tr>
											</thead>
											<tbody id="resultsFormOmrBody">
											</tbody>
										</table>
									</div>
								</div>
								<div class="x_panel" id='qr_table'>
									<div class="x_title">
										<h2>QR CODE <small>Results</small></h2>
										<div class="clearfix"></div>
									</div>
									<div class="x_content">
										<table id="datatable-buttons3" class="table table-striped table-bordered dataTable datatable-buttons">
											<thead>
												<tr id="resultsFormBcrHead">
												</tr>
											</thead>
											<tbody id="resultsFormBcrBody">
											</tbody>
										</table>
									</div>
								</div>
								<div class="x_panel" id='ocr_table'>
									<div class="x_title">
										<h2>OCR <small>Results</small></h2>
										<div class="clearfix"></div>
									</div>
									<div class="x_content">
										<table id="datatable-buttons1" class="table table-striped table-bordered dataTable datatable-buttons">
											<thead>
												<tr id="resultsFormOcrHead">
												</tr>
											</thead>
											<tbody id="resultsFormOcrBody">
											</tbody>
										</table>
									</div>
								</div>
								<div class="x_panel cutting" id='img_table' hidden>
									<div class="x_title">
										<h2>IMG <small>Results</small></h2>
										<div class="clearfix"></div>
									</div>
									<div class="x_content">
										<table id="datatable-buttons4" class="table table-striped table-bordered dataTable datatable-buttons">
											<thead>
												<tr id="resultsFormImgHead">
												</tr>
											</thead>
											<tbody id="resultsFormImgBody">
											</tbody>
										</table>
									</div>
								</div>
								<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true"  id="modal_cuttings" >
									<div class="modal-dialog modal-lg">
										<div class="modal-content">
											<form action="javascript:gradeImage2();">
												<div class="modal-header">
													<h4 class="modal-title" id="myModalLabel2">IMG</h4>
												</div>
												<div class="modal-body">
													<div class="form-group">
														<div align="center"><img id="temp_img" style="max-width: 800px;"></div>
														<input id="gradeImage" type="text" class="form-control" name="gradeImage" autofocus placeholder="Grade Image" required>
													</div>
												</div>
												<div class="modal-footer">
													<button type="submit" class="btn btn-primary">Grade Image</button>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
							<div id="files_input">
								Images Files<input type="file" id="files" name="files[]" multiple accept=".png, .jpeg, .jpg"/>
								PDF File<input id='pdf' type='file' accept=".pdf"/>
							</div>

							<div id="redForm_run" hidden>
								<div class="row">
									<div class="form-group col-lg-2" align="center">
										<br>
										<a id="run" class="btn btn-app">
											<i class="fa fa-print"></i> FormRead
										</a>
									</div>
									<div class="form-group col-lg-2" align="center">
										<h2>Mark Darkness</h2> <input type="number" min="0" max="100" id="darkness" value="30" class="form-control">
									</div>
									<div class="form-group col-lg-3" align="center">
										<h2>OCR Language</h2> <select id="langsel" class="form-control" onchange="window.lastFile && recognizeFile(window.lastFile)">
											<option value='afr'     > Afrikaans             </option>
											<option value='ara'     > Arabic                </option>
											<option value='aze'     > Azerbaijani           </option>
											<option value='bel'     > Belarusian            </option>
											<option value='ben'     > Bengali               </option>
											<option value='bul'     > Bulgarian             </option>
											<option value='cat'     > Catalan               </option>
											<option value='ces'     > Czech                 </option>
											<option value='chi_sim' > Chinese               </option>
											<option value='chi_tra' > Traditional Chinese   </option>
											<option value='chr'     > Cherokee              </option>
											<option value='dan'     > Danish                </option>
											<option value='deu'     > German                </option>
											<option value='ell'     > Greek                 </option>
											<option value='eng'     selected> English                </option>
											<option value='enm'     > English (Old)         </option>
											<option value='meme'     > Internet Meme                </option>
											<option value='epo'     > Esperanto             </option>
											<option value='epo_alt' > Esperanto alternative </option>
											<option value='equ'     > Math                  </option>
											<option value='est'     > Estonian              </option>
											<option value='eus'     > Basque                </option>
											<option value='fin'     > Finnish               </option>
											<option value='fra'     > French                </option>
											<option value='frk'     > Frankish              </option>
											<option value='frm'     > French (Old)          </option>
											<option value='glg'     > Galician              </option>
											<option value='grc'     > Ancient Greek         </option>
											<option value='heb'     > Hebrew                </option>
											<option value='hin'     > Hindi                 </option>
											<option value='hrv'     > Croatian              </option>
											<option value='hun'     > Hungarian             </option>
											<option value='ind'     > Indonesian            </option>
											<option value='isl'     > Icelandic             </option>
											<option value='ita'     > Italian               </option>
											<option value='ita_old' > Italian (Old)         </option>
											<option value='jpn'     > Japanese              </option>
											<option value='kan'     > Kannada               </option>
											<option value='kor'     > Korean                </option>
											<option value='lav'     > Latvian               </option>
											<option value='lit'     > Lithuanian            </option>
											<option value='mal'     > Malayalam             </option>
											<option value='mkd'     > Macedonian            </option>
											<option value='mlt'     > Maltese               </option>
											<option value='msa'     > Malay                 </option>
											<option value='nld'     > Dutch                 </option>
											<option value='nor'     > Norwegian             </option>
											<option value='pol'     > Polish                </option>
											<option value='por'     > Portuguese            </option>
											<option value='ron'     > Romanian              </option>
											<option value='rus'     > Russian               </option>
											<option value='slk'     > Slovakian             </option>
											<option value='slv'     > Slovenian             </option>
											<option value='spa'     > Spanish               </option>
											<option value='spa_old' > Old Spanish           </option>
											<option value='sqi'     > Albanian              </option>
											<option value='srp'     > Serbian (Latin)       </option>
											<option value='swa'     > Swahili               </option>
											<option value='swe'     > Swedish               </option>
											<option value='tam'     > Tamil                 </option>
											<option value='tel'     > Telugu                </option>
											<option value='tgl'     > Tagalog               </option>
											<option value='tha'     > Thai                  </option>
											<option value='tur'     > Turkish               </option>
											<option value='ukr'     > Ukrainian             </option>
											<option value='vie'     > Vietnamese            </option>
										</select>
									</div>
									<div class="form-group col-lg-3" align="center">
										<h2>Threshold <a id="see_threshold"><span class="fa fa-eye"></span></a><a id="hide_threshold" hidden><span class="fa fa-eye-slash" hidden></span></a></h2><input type="range" min="1" max="255" id="threshold" value="147" class="form-control"><span id="thresholdValue"></span>
									</div>
								</div>
							</div>

							<canvas id="threshold_canvas" width="300" height="300" style="z-index:1" hidden></canvas>

							<div id="preview">
								<output id="list"></output><br>
								<output id="list2"></output><br>
								<div id="status"></div>
							</div>
							<p id="demo"></p>

							<div class="modal" id="loading">
								<br><br><br><br><br><br><br><br><br>
								<div class="circle"></div>
								<div class="circle1"></div>
							</div>

							<script type="text/javascript" src="http://formread.org/app/js/dtables.js?t=17175"></script>
							<script src="http://formread.org/app/js/qcode-decoder.min.js"></script>
							<script src="https://cdn.rawgit.com/naptha/tesseract.js/1.0.7/dist/tesseract.js"></script>
							<script src="http://formread.org/app/js/ocrad.min.js"></script>
							<script src="http://cdnjs.cloudflare.com/ajax/libs/processing.js/1.4.1/processing-api.min.js"></script>
							<script type="text/javascript" src="http://formread.org/app/js/pdfjs/build/pdf.js"></script>
							<script src="http://formread.org/app/js/jsQR.js"></script>
							<script src="https://cdn.rawgit.com/serratus/quaggaJS/0420d5e0/dist/quagga.min.js"></script>
							<script>
								$body = $("body");
								$(document).on({
									ajaxStart: function() { $body.addClass("loading");    },
									ajaxStop: function() { $body.removeClass("loading"); }
								});
    /*$(function () {
        $('.modal').modal({
            show: false,
            keyboard: false,
            backdrop: 'static'
        });
    });*/
      // Check for the various File API support.
      if (window.File && window.FileReader && window.FileList && window.Blob) {
      } else {
      	alert('The File APIs are not fully supported in this browser.');
      }
      var ctx;
      var imageURLs=[];
      document.getElementById('files').addEventListener('change', handleFileSelect, false);
      document.getElementById('pdf').addEventListener('change', handleFileSelectPdf);
      document.getElementById('run').addEventListener('click', read);
      var imgs=[];
      var relativeCoord = [];
      var MAX_RATIO_A4 = 0.728;
      var MIN_RATIO_A4 = 0.704;
      var MAX_RATIO_LETTER = 0.776;
      var MIN_RATIO_LETTER = 0.768;
      var threshold_canvas = document.getElementById('threshold_canvas');
      var threshold_ctx;
      var threshold_img = new Image;
      var storeOmrImgRoute = "http://formread.org/app/storeOmrImg";
      var updateUsageRoute = "http://formread.org/app/updateUsage";
      var darkn = document.getElementById("darkness").value;
      $('#thresholdValue').html(threshold);
      $('#gradeImg').click(function() {
      	gradeImage();
      });
      $('#see_threshold').click(function() {
      	$('#see_threshold').hide();
      	$('#hide_threshold').show();
      	$('#threshold_canvas').show();
      });
      $('#hide_threshold').click(function() {
      	$('#see_threshold').show();
      	$('#hide_threshold').hide();
      	$('#threshold_canvas').hide();
      });
      $('#threshold').change(function() {
      	threshold=$('#threshold').val();
      	$('#thresholdValue').html(threshold);
      	threshold_img = document.getElementsByName('forms')[0];
      	threshold_ctx = threshold_canvas.getContext("2d");
      	threshold_ctx.clearRect(0, 0, threshold_canvas.width, threshold_canvas.height);
      	threshold_canvas.width = threshold_img.width;
      	threshold_canvas.height = threshold_img.height;
      	threshold_ctx.drawImage(threshold_img, 0, 0, threshold_img.width, threshold_img.height);
      	tobwimg=threshold_ctx.getImageData(0,0,threshold_canvas.width, threshold_canvas.height);
      	toblackWhite(tobwimg, threshold_ctx);
      });

      
  </script>

</div>
</div> <!-- wizard container -->
</div>
</div> <!-- row -->
</div> <!--  big container -->
<div class="footer">
	<div class="container text-center">
		Teacher Efficiency Rating Scale Form: Web Application Scanner <i class="fa fa-heart heart"></i> by <a href="http://www.msugensan.edu.ph/msugensantos/">Team P.G.T. 
			&copy;
			<script>
				document.write(new Date().getFullYear())
			</script></a>
		</div>
	</div>
</div>
<!--   Core JS Files   -->
<script src="assets/js/jquery-2.2.4.min.js" type="text/javascript"></script>
<script src="assets/js/bootstrap.min.js" type="text/javascript"></script>
<script src="assets/js/jquery.bootstrap.js" type="text/javascript"></script>
<!--  Plugin for the Wizard -->
<script src="assets/js/material-bootstrap-wizard.js"></script>

<script src="assets/js/jquery.validate.min.js"></script>
<!--  tesseract.js	 -->
<script src='https://cdn.jsdelivr.net/gh/naptha/tesseract.js@v1.0.14/dist/tesseract.min.js'></script>

<!-- Datatables -->
<script src="assets/vendors/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="assets/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
<script src="assets/vendors/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="assets/vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
<script src="assets/vendors/datatables.net-buttons/js/buttons.flash.min.js"></script>
<script src="assets/vendors/datatables.net-buttons/js/buttons.html5.min.js"></script>
<script src="assets/vendors/datatables.net-buttons/js/buttons.print.min.js"></script>
<script src="assets/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
<script src="assets/vendors/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
<script src="assets/vendors/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="assets/vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js"></script>
<script src="assets/vendors/jszip/dist/jszip.min.js"></script>
<script src="assets/vendors/pdfmake/build/pdfmake.min.js"></script>
<script src="assets/vendors/pdfmake/build/vfs_fonts.js"></script>


<script>
	function progressUpdate(packet){
		var log = document.getElementById('log');
		if(log.firstChild && log.firstChild.status === packet.status){
			if('progress' in packet){
				var progress = log.firstChild.querySelector('progress')
				progress.value = packet.progress
			}
		}else{
			var line = document.createElement('div');
			line.status = packet.status;
			var status = document.createElement('div')
			status.className = 'status'
			status.appendChild(document.createTextNode(packet.status))
			line.appendChild(status)
			if('progress' in packet){
				var progress = document.createElement('progress')
				progress.value = packet.progress
				progress.max = 1
				line.appendChild(progress)
			}
			if(packet.status == 'done'){
				var pre = document.createElement('pre')
				pre.appendChild(document.createTextNode(packet.data.text))
				line.innerHTML = ''
				line.appendChild(pre)
			}
			log.insertBefore(line, log.firstChild)
		}
	}
	function recognizeFile(file){
		document.querySelector("#log").innerHTML = ''
		Tesseract.recognize(file, {
			lang: document.querySelector('eng')
		})
		.progress(function(packet){
			console.info(packet)
			progressUpdate(packet)
		})
		.then(function(data){
			console.log(data)
			progressUpdate({ status: 'done', data: data })
		})
	}
</script>

<!-- Datatables -->
<script>
	$('#settable').click(function() {
		$(this).hide();
		$('#gradeImg').hide();

		var head = $('#datatable-buttons4 thead tr th');
		var body = $('#datatable-buttons4 tbody tr');
		$("#datatable-buttons2 thead tr th:first-child").after(head);
		$("#datatable-buttons2 tbody tr").each(function(i) {
			$('td:first-child', this).after(body.eq(i).children());
		});
		$('#img_table').remove();
		var head = $('#datatable-buttons1 thead tr th');
		var body = $('#datatable-buttons1 tbody tr');
		$("#datatable-buttons2 thead tr th:first-child").after(head);
		$("#datatable-buttons2 tbody tr").each(function(i) {
			$('td:first-child', this).after(body.eq(i).children());
		});
		$('#ocr_table').remove();
		var head = $('#datatable-buttons3 thead tr th');
		var body = $('#datatable-buttons3 tbody tr');
		$("#datatable-buttons2 thead tr th:first-child").after(head);
		$("#datatable-buttons2 tbody tr").each(function(i) {
			$('td:first-child', this).after(body.eq(i).children());
		});
		$('#qr_table').remove();
		var handleDataTableButtons = function() {
			if ($("#datatable-buttons2").length) {
				$("#datatable-buttons2").DataTable({
					dom: "Bfrtip",
					buttons: [
					{
						extend: "copy",
						className: "btn-sm"
					},
					{
						extend: "csv",
						className: "btn-sm"
					},
					{
						extend: "excel",
						className: "btn-sm"
					},
					{
						extend: "pdfHtml5",
						className: "btn-sm"
					},
					{
						extend: "print",
						className: "btn-sm"
					},
					],
					responsive: true
				});
			}
		};

		TableManageButtons = function() {
			"use strict";
			return {
				init: function() {
					handleDataTableButtons();
				}
			};
		}();

		$('#datatable').dataTable();

		$('#datatable-keytable').DataTable({
			keys: true
		});

		$('#datatable-responsive').DataTable();

		$('#datatable-scroller').DataTable({
			ajax: "js/datatables/json/scroller-demo.json",
			deferRender: true,
			scrollY: 380,
			scrollCollapse: true,
			scroller: true
		});

		$('#datatable-fixed-header').DataTable({
			fixedHeader: true
		});

		var $datatable = $('#datatable-checkbox');

		$datatable.dataTable({
			'order': [[ 1, 'asc' ]],
			'columnDefs': [
			{ orderable: false, targets: [0] }
			]
		});
		$datatable.on('draw.dt', function() {
			$('input').iCheck({
				checkboxClass: 'icheckbox_flat-green'
			});
		});

		TableManageButtons.init();
	});
      //$(document).ready(function() { $('.dataTable').dataTable(); });
  </script>
  <!-- /Datatables -->

  <style>
  	#log > div {
  		color: #313131;
  		border-top: 1px solid #dadada;
  		padding: 9px;
  		display: flex;
  	}
  	#log > div:first-child {
  		border: 0;
  	}
  	.status {
  		min-width: 250px;
  	}
  	#log {
  		border: 1px solid #dadada;
  		padding: 10px;
  		margin-top: 20px;
  		min-height: 100px;
  	}
  	body {
  		font-family: sans-serif;
  		margin: 30px;
  	}
  	progress {
  		display: block;
  		width: 100%;
  		transition: opacity 0.5s linear;
  	}
  	progress[value="1"] {
  		opacity: 0.5;
  	}
  </style>

</body>

</html>
